# WebAPI 第二天

## 目标 ：掌握事件发生的过程、掌握事件对象

- [x] 掌握根据选择器获取元素
- [x] 掌握注册事件的两个方式
- [x] 掌握解除事件的两个方式
- [x] 能理解事件的三个阶段
- [ ] 能阻止事件冒泡
- [ ] 能理解事件委托
- [ ] 能掌握事件对象的获取和使用

## 1. 获取元素（CSS选择器方式）

> 目标：能够通过css选择器的方式获取到元素

### 1.1 获取符合CSS选择器的第一个元素

* **语法**：`element.querySelector('css选择器')`
* **参数**
  
  * 类型：字符串
* 值： CSS选择器
  
* **返回**
  
  * 类型：对象
* 值：得到element元素中，符合CSS选择器要求的第一个元素
  
* **例子**

  ```html
  1.创建ul中有4个li，第一个li无属性，后面三个li都有class属性是lis
  2.分别通过css选择器的方式获取ul元素，获取第一个li，和第二个li
  ```

### 1.2 获取符合CSS选择器的所有元素

* **语法**：`element.querySelectorAll('css选择器')`

* **参数**
  
  * 类型：字符串
* 值：css选择器
  
* **返回**
  
  * 类型：伪数组
* 值：得到element元素中，符合CSS选择器要求的所有元素
  
* **例子**

  ```html
  1.创建3个input元素type类型是checkbox，class属性是ck，且第一个和第二个是选中状态的元素
  2.获取所有checkbox，获取所有选中的checkbox
  ```

* **案例**：全选反选

## 2.事件高级

> 目标：掌握注册事件的两种方式、掌握删除元素上的事件、掌握事件传播的三个阶段和每个阶段的特点、知道事件委托的原理、学会使用事件委托的方式绑定事件、掌握如何阻止事件冒泡、学会操作事件对象的属性

### 2.1 注册事件两种方式

#### 2.1.1  **DOM0级事件**（on）

* **语法**：`element.on+事件类型 = 函数名/匿名函数`

* **特点**：同一个元素只能注册一次某个类型的事件，多次注册，只有最后一次添加的事件有效

  ```html
  1. 创建一个button元素
  2. 用 element.on+事件类型 = 函数名/匿名函数  语法给button元素添加两个点击事件，在事件处理程序中
     分别打印‘我是第n个注册的事件’
  ```

#### 2.1.2  **DOM2级事件** （addEventListener）

* **语法**：`element.addEventListener('事件类型'，函数名/匿名函数)`

* **参数**

  * 第一个：字符串    事件类型 **不加on**
  * 第二个：匿名函数/函数名（事件执行程序）

* **特点**：同一个元素能注册多个某种类型的事件，多次注册，事件触发时，会按照注册的先后顺序依次执行

  ```html
  1. 创建一个button元素
  2. 用  element.addEventListener('事件类型'，函数名/匿名函数)  语法给button元素添加两个点击事件
     分别打印‘我是第n个注册的事件’
  ```

### 2.2 解除事件的两种方式

#### 2.2.1  **DOM0级事件解除方式**（on）

* **语法**：`element.on+事件类型 = null`

  ```html
  1. 创建一个button元素
  2. 用  element.on+事件类型 = 函数名/匿名函数  给button元素添加一个点击事件，
     再事件处理程序中使用 element.on+事件类型 = null 将该事件解绑，再次点击元素
  ```

#### 2.2.2  **DOM2级事件解除方式**（removeListener）

* **语法**：`element.removeEventListener('事件类型'，函数名)`

* **注意**：**想要解除某个事件，前提是这个事件注册时添加的事件处理函数是有名函数**

  ```html
  1. 创建一个button元素
  2. 用element.addEventListener('事件类型'，函数名)  给button元素添加一个点击事件，
     再事件处理程序中使用 element.removeEventListener('事件类型'，函数名) 将该事件解绑，再次点击元    素
  ```
  
* **案例**：抽奖（两种方式：解绑事件，开关思想）

## 3. DOM 事件流

### 3.1 DOM事件流概念

- **定义**：事件发生时会在元素节点之间按照特定的顺序传播，这个传播过程即 **DOM 事件流**

- **DOM事件流的三个阶段**

  当一个DOM事件触发时，它不是在触发的对象上只触发一次的，而是经历三个阶段。分别为

  1. 一开始从文档的根节点流向目标对象（**捕获阶段**）

  - 特点：在这个阶段，触发某个子元素的事件，其所有父元素上绑定的相同类型的事件都会被触发，且先执行父级事件

  2. 然后在目标对象上被触发（**目标阶段**）
  3. 最后再回溯到文档的根节点（**冒泡阶段**）

  - 特点：在这个阶段，触发某个子元素，其所有父元素上绑定的相同类型的事件都会被触发，先执行子元素事件

​        再执行父级元素事件

  <img src="/image/1557457360104.png">

### 3.2 捕获事件和冒泡事件

   由于一个DOM事件触发时只能监听事件传播的一个阶段，要么是捕获阶段，要么是冒泡阶段，

   因此将DOM事件分成了两类，捕获事件和冒泡事件

- **捕获事件**
  - 利用 `addEventListener('事件类型',函数名/匿名函数,boolean)` 给元素绑定事件，当第三个参数
    - true，该事件就是捕获事件
    - false（不写默认就是false），该事件是冒泡事件
- **演示**

```html
  1.创建三个关系是子级、父级、爷爷级别的div元素
  2.分别给这个三个元素添加点击事件且该事件是捕获阶段
```

- **冒泡事件**

  - 利用 `element.on+事件类型 = 函数名/匿名函数`给元素绑定的事件，都是冒泡事件
  - **演示**

  ```html
  1.创建三个关系是子级、父级、爷爷级别的div元素
  2.分别给这个三个元素添加点击事件且该事件是冒泡阶段
  ```

### 3.3 冒泡事件的影响

> 原因：由于事件冒泡阶段具有点击某个子元素，其父元素上绑定的点击事件也会触发的特点，有时候我们需要利用这个特性，有的时候要避开这个特性

- **利用 ** : 事件委托
  - **解决问题**
    - 同时给100个`li`元素添加点击事件：遍历添加事件消耗性能多
    - 给动态生成的元素添加事件 ：由于事件是先绑定的，如果动态添加元素，就需要每添加一个，就绑定一次事件  消耗性能多
  - **原理**：为了给子元素添加事件，可以将事件委托给父级，就是把事件绑定在父级身上，只需要绑定一次，在触发子元素的时候，由于冒泡就会触发父级元素的事件
  - **获取触发元素**：`event.target`
  - **例子**

```
1.创建一个ul，内部有10个li元素，点击li元素的时候打印‘点击了li’
2.创建一个按钮，给按钮添加点击事件，并在事件内部，给ul动态添加li元素，且要让新添加的li元素有事件，
同样打印‘点击了li’
```

- **避开** :  阻止事件冒泡

  - **造成影响**：父级子级绑定相同事件，但是在点击子级的时候，不希望父级的事件触发，但是由于事件冒泡

    会触发父级的事件

  - **阻止冒泡语法**：`event.stopPropagation();`

  - **例子**

    ```html
    1.创建三个关系是子级、父级、爷爷级别的div元素
    2.分别给这个三个元素添加点击事件且该事件是冒泡阶段
    ```

## 4. 事件对象

### 4.1 事件对象概念

- **官方描述**：event 对象代表事件的状态，比如键盘按键的状态、鼠标的位置、鼠标按钮的状态

- **大白话描述**：事件发生后，跟事件相关的一系列信息数据的集合都放到这个对象里面，这个对象就是事件对象 

  event，它有很多属性和方法

​       比如：  谁绑定了这个事件 、鼠标触发事件的话，

​					会得到鼠标的相关信息，如鼠标位置、键盘触发事件的话，                          

​				    会得到键盘的相关信息，如按了哪个键

- **注意**：只有在事件执行程序中存在event对象

### 4.2 事件对象的使用方式

- **直接使用`event`关键字**
- **自定义名称**（重要）：需要作为事件执行函数的形参 通常使用`e` 或`evt`

```
eventTarget.onclick = function(e) {
// 这个 event 就是事件对象，我们还喜欢的写成 e 或者 evt 
} 
eventTarget.addEventListener('click', function(evt) {
// 这个 event 就是事件对象，我们还喜欢的写成 e 或者 evt 
}）
```

### 4.3 事件对象常用属性

- `event.target` : 触发事件的元素  和this的区别是 this指向绑定事件的元素

- `event.stopPropagation()`: 阻止事件冒泡

- `event.preventDefault()`: 阻止默认行为

  - 默认行为：比如a标签跳转

    ```html
    1.创建一个a标签
    2.点击a标签不让a标签跳转 'https://www.baidu.com/'
    ```

- 光标坐标

  - `event.clientX`: 光标相对视口的横坐标

  - `event.clientY`: 光标相对视口的纵坐标

  - `event.pageX`: 光标相对文档的横坐标（包含滚动条）

  - `event.pageY`: 光标相对文档的纵坐标（包含滚动条）

  - `event.offsetX`:光标相对于绑定事件元素的横坐标

  - `event.offsetY`:光标相对于绑定事件元素的纵坐标

    ```html
    1.给文档添加点击事件，获取鼠标点击相对视口和文档的坐标
    ```

​          

## 5. 事件类型

- **鼠标按下**：`mousedown`

- **鼠标抬起**：`mouseup`

- **鼠标移动**：`mou`

- `semove`

  - 案例：图片跟着鼠标飞

- **右键菜单**：`contextmenu`

  - 阻止系统右键菜单

  ```html
  <script>
  	document.oncontextmenu = function(e){
        console.log(e);
        e.preventDefault();  // 阻止默认事件
      }
  </script>
  ```

## 6.案例

### 6.1 图片跟着鼠标飞

- **效果**：图片跟随鼠标光标移动
- **思路**：
  1. 获取光标坐标

2. 设置图片的坐标为光标坐标

- **步骤**： 

  1. 获取图片元素

  2. 给文档添加鼠标移动事件,在事件执行函数中

     2.1 通过event对象获取光标坐标

     2.2 设置图片的坐标为event对象获取光标坐标

### 6.2 拖动页面元素

- **效果**：按住元素，元素跟着鼠标动，松开鼠标，元素不跟着鼠标动

- **思路**：

  1. 鼠标在图片按下时允许图片跟着鼠标动的开关开启
  2. 开关开启时鼠标在文档中滑动时，让元素跟着鼠标移
  3. 鼠标在文档上抬起时，开关关闭

- **步骤**：

  1. 获取拖动元素

  2. 设置全局变量为开关，开关默认关闭，初始值设置为false,设置全局变量作为鼠标相对元素的坐标

  3. 给拖动元素添加鼠标按下事件，在事件处理函数中

     3.1 开启开关，将开关变量设置为true

     3.2 获取鼠标相对拖动元素的位置   

  4. 给文档添加鼠标移动事件，在事件处理函数中

     4.1 判断开关是否开启

     ​     4.1.1 获取鼠标坐标

     ​     4.1.2 设置拖动元素的坐标为鼠标坐标减去鼠标相对元素的坐标

  5. 给文档添加鼠标抬起事件，在事件处理函数中

  ​        5.1 将开关关闭

### 6.3 禁止右键菜单

- **效果**：点击右键不弹出系统默认菜单
- **思路**：
  1. 禁止菜单右键默认行为
- **步骤**：
  1. 给文档添加菜单事件
  2. 在事件执行函数中，阻止默认事件

